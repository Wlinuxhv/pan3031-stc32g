# PAN3031 STC32G12K128 工程

基于 PAN3031 无线模块驱动的 STC32G12K128 移植版本。

## STC32G 官方头文件

本项目使用自定义的 `STC32G.h`，兼容 STC32G 系列单片机。

如需使用 STC 官方头文件，请从以下途径获取：

### 官方下载
- **官网**: https://www.stcmcudata.com/
- **STC-ISP 工具**: 随软件附带官方头文件
- **Keil 库**: STC 官方提供的 Keil 支持包

### 官方头文件位置
STC 官方头文件通常位于:
```
STC\STC32G\STC32G.h
```

### 替换方法
如需使用官方头文件，将本项目的 `STC32G.h` 替换为:
```c
#include <STC32G.h>
```

并在 Keil 工程选项中添加官方头文件路径。

## 目录结构

```
pan3031_stc32g/
├── STC32G.h              # STC32G12K128 寄存器定义
├── HAL/
│   ├── spi/              # SPI 驱动 (软件模拟)
│   ├── gpio/             # GPIO 驱动
│   ├── delay/            # 延时函数
│   └── uart/             # UART 调试串口
├── Radio/
│   ├── inc/              # 核心驱动头文件
│   │   ├── pan3031.h
│   │   ├── radio.h
│   │   ├── crc.h
│   │   └── pan3031_port.h
│   └── src/              # 核心驱动源文件
│       ├── pan3031.c
│       ├── radio.c
│       ├── crc.c
│       └── pan3031_port.c
└── User/
    └── main.c            # 主程序
```

## 引脚分配

### SPI 接口 (软件模拟)

| 功能   | STC32G 引脚 | 说明           |
|--------|-------------|----------------|
| SCK    | P2.2        | SPI 时钟       |
| MISO   | P2.1        | SPI 数据输入   |
| MOSI   | P2.0        | SPI 数据输出   |
| CS     | P2.3        | PAN3031 片选   |

### GPIO 控制

| 功能   | STC32G 引脚 | 说明             |
|--------|-------------|------------------|
| IRQ    | P3.2        | PAN3031 中断输出 |
| RST    | P3.3        | PAN3031 复位     |
| TX_EN  | P3.4        | 发射使能        |
| RX_EN  | P3.5        | 接收使能        |

### 调试串口

| 功能   | STC32G 引脚 | 说明           |
|--------|-------------|----------------|
| TXD    | P3.1        | UART1 发送     |
| RXD    | P3.0        | UART1 接收     |

### 状态指示

| 功能   | STC32G 引脚 | 说明           |
|--------|-------------|----------------|
| LED1   | P5.4        | 状态指示灯     |

## Keil C51 使用说明

### 1. 创建工程

1. 打开 Keil uVision5
2. Project -> New uVision Project
3. 选择 STC32G12K128 作为目标芯片
4. 添加上述源文件到工程

### 2. 编译器设置

- 选择 Intel 8051 C 编译器
- 设置代码大小: 128KB
- 设置内存模型: Large

### 3. 烧录

使用 STC 串口下载工具烧录:
- 波特率: 115200
- 停止位: 1
- 校验位: None

## 默认参数

- 频率: 433 MHz
- 扩频因子: SF7
- 带宽: 125 KHz
- 码率: 4/8
- 发射功率: 29 dBm (可调)

## 注意事项

1. 确保外部晶振频率为 24MHz
2. SPI 使用软件模拟，可根据需要调整引脚
3. IRQ 引脚需要配置为外部中断 0
4. PAN3031 模块需要 3.3V 供电
